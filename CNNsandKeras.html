<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=W8Jl-jxzzEnyRbrIe94pab6XCTtZ5ZuBkyznC1EZfL9hBSK8TwnmX7_MxI-MEYS8BRFKUaAHKqnvhGgz58RGvLSiy91AzhKJSzS5iLNGEWA');ol{margin:0;padding:0}table td,table th{padding:0}.c10{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10.5pt;font-family:"Courier";font-style:italic}.c24{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:8pt;font-family:"Times";font-style:normal}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:7.8pt;font-family:"Helvetica Neue";font-style:normal}.c37{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10.5pt;font-family:"Helvetica Neue";font-style:normal}.c40{margin-left:77.3pt;padding-top:0.4pt;text-indent:-0.8pt;padding-bottom:0pt;line-height:1.0114989280700684;text-align:left;margin-right:20pt}.c21{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:16.5pt;font-family:"Helvetica Neue";font-style:normal}.c18{margin-left:77.4pt;padding-top:35pt;text-indent:-0.7pt;padding-bottom:0pt;line-height:0.8705018758773804;text-align:left;margin-right:51.4pt}.c7{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:13.5pt;font-family:"Helvetica Neue";font-style:normal}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10.5pt;font-family:"Courier";font-style:normal}.c26{margin-left:76.7pt;padding-top:0.4pt;text-indent:0.2pt;padding-bottom:0pt;line-height:1.0115002393722534;text-align:left;margin-right:26.4pt}.c35{margin-left:76.9pt;padding-top:0.5pt;text-indent:0.3pt;padding-bottom:0pt;line-height:1.0114989280700684;text-align:justify;margin-right:20pt}.c6{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:10.5pt;font-family:"Courier";font-style:normal}.c33{margin-left:77.6pt;padding-top:12.9pt;text-indent:-0.5pt;padding-bottom:0pt;line-height:3.2730906009674072;text-align:left;margin-right:104.1pt}.c47{margin-left:77.5pt;padding-top:9.5pt;text-indent:-0.5pt;padding-bottom:0pt;line-height:1.011492133140564;text-align:left;margin-right:284.9pt}.c44{margin-left:77.6pt;padding-top:10.1pt;text-indent:-1.2pt;padding-bottom:0pt;line-height:0.9458702802658081;text-align:left;margin-right:289.5pt}.c39{margin-left:16pt;padding-top:578.8pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c49{margin-left:77.1pt;padding-top:27.5pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c20{margin-left:76.4pt;padding-top:28.3pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c45{margin-left:76.6pt;padding-top:10.8pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c22{margin-left:76.8pt;padding-top:29pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c8{margin-left:76.9pt;padding-top:27.5pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c12{margin-left:16pt;padding-top:220.6pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c9{margin-left:16pt;padding-top:19.6pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c28{padding-top:19.1pt;padding-bottom:0pt;line-height:1.0115019083023071;text-align:left}.c3{padding-top:0.5pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c46{padding-top:18pt;padding-bottom:0pt;line-height:6.544990539550781;text-align:left}.c19{padding-top:18.4pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c16{padding-top:19.1pt;padding-bottom:0pt;line-height:1.0114989280700684;text-align:left}.c36{padding-top:19.3pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c48{padding-top:18.3pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c29{padding-top:17.8pt;padding-bottom:0pt;line-height:1.0;text-align:center}.c34{padding-top:28.7pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c31{padding-top:0pt;padding-bottom:0pt;line-height:1.0114796161651611;text-align:left}.c17{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:center}.c32{padding-top:0.4pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c27{padding-top:42.5pt;padding-bottom:0pt;line-height:3.510474681854248;text-align:left}.c25{padding-top:0pt;padding-bottom:0pt;line-height:1.0114995241165161;text-align:left}.c43{padding-top:20pt;padding-bottom:0pt;line-height:3.5105040073394775;text-align:left}.c15{padding-top:28.2pt;padding-bottom:0pt;line-height:3.6210503578186035;text-align:left}.c14{padding-top:0pt;padding-bottom:0pt;line-height:1.0115019083023071;text-align:left}.c4{padding-top:0pt;padding-bottom:0pt;line-height:1.0114989280700684;text-align:left}.c38{padding-top:134.1pt;padding-bottom:0pt;line-height:3.510493040084839;text-align:left}.c30{padding-top:13.7pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c11{padding-top:0pt;padding-bottom:0pt;line-height:1.011492133140564;text-align:left}.c42{padding-top:10.3pt;padding-bottom:0pt;line-height:1.734365463256836;text-align:left}.c23{padding-top:29.7pt;padding-bottom:0pt;line-height:1.0114796161651611;text-align:left}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c41{background-color:#ffffff;max-width:558.9pt;padding:14pt 26.5pt 17pt 26.6pt}.c5{margin-left:76.5pt}.c13{margin-left:0.7pt}.title{padding-top:24pt;color:#000000;font-weight:700;font-size:36pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:18pt;color:#666666;font-size:24pt;padding-bottom:4pt;font-family:"Georgia";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:24pt;color:#000000;font-weight:700;font-size:24pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-weight:700;font-size:18pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:14pt;color:#000000;font-weight:700;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:12pt;color:#000000;font-weight:700;font-size:12pt;padding-bottom:2pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:11pt;color:#000000;font-weight:700;font-size:11pt;padding-bottom:2pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:10pt;color:#000000;font-weight:700;font-size:10pt;padding-bottom:2pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}</style></head><body><div class="c41"><p class="c2 c13"><span class="c24">11/6/2020 CNNs and Keras </span></p><p class="c34"><span class="c0">In&nbsp;[*]: </span></p><p class="c38"><span class="c0">In&nbsp;[&nbsp;]: In&nbsp;[&nbsp;]: In&nbsp;[13]: </span></p><p class="c2"><span class="c0">1 </span></p><p class="c2"><span class="c6">import </span><span class="c0">pandas </span><span class="c6">as </span><span class="c0">pd </span></p><p class="c3"><span class="c0">2 </span></p><p class="c2"><span class="c6">import </span><span class="c0">numpy </span><span class="c6">as </span><span class="c0">np </span></p><p class="c3"><span class="c0">3 </span></p><p class="c4"><span class="c6">from </span><span class="c0">matplotlib </span><span class="c6">import </span><span class="c0">pyplot </span><span class="c6">as </span><span class="c0">plt 4 </span></p><p class="c2"><span class="c6">%</span><span class="c0">matplotlib inline </span></p><p class="c3"><span class="c0">5 </span></p><p class="c2"><span class="c6">import </span><span class="c0">seaborn </span><span class="c6">as </span><span class="c0">sns </span></p><p class="c3"><span class="c0">6 </span></p><p class="c2"><span class="c6">import </span><span class="c0">warnings </span></p><p class="c3"><span class="c0">7 </span></p><p class="c2"><span class="c0">warnings.filterwarnings(&#39;ignore&#39;) </span></p><p class="c3"><span class="c0">8 </span></p><p class="c2"><span class="c6">from </span><span class="c0">sklearn </span><span class="c6">import </span><span class="c0">metrics </span></p><p class="c3"><span class="c0">9 </span></p><p class="c4"><span class="c6">from </span><span class="c0">tensorflow.keras </span><span class="c6">import </span><span class="c0">Sequential 10 </span></p><p class="c2"><span class="c6">from </span><span class="c0">tensorflow.keras.layers </span><span class="c6">import </span><span class="c0">Dense </span></p><p class="c36"><span class="c0">1 </span></p><p class="c2"><span class="c0">data = np.load(&quot;images.npy&quot;) </span></p><p class="c3"><span class="c0">2 </span></p><p class="c2"><span class="c0">data.shape </span></p><p class="c36"><span class="c0">1 </span></p><p class="c4"><span class="c0">labels = pd.read_csv(&quot;Labels.csv&quot;) 2 </span></p><p class="c2"><span class="c0">labels.head() </span></p><p class="c36"><span class="c0">1 </span></p><p class="c14"><span class="c6">from </span><span class="c0">matplotlib </span><span class="c6">import </span><span class="c0">pyplot </span><span class="c6">as </span><span class="c0">plt 2 </span></p><p class="c32"><span class="c0">3 </span></p><p class="c2"><span class="c0">plt.imshow(data[0]) </span></p><p class="c3"><span class="c0">4 </span></p><p class="c2"><span class="c0">plt.show() </span></p><p class="c42"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 257.23px; height: 251.23px;"><img alt="" src="images/image1.png" style="width: 257.23px; height: 251.23px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c1">Typesetting math: 0%</span></p><p class="c17"><span class="c24">localhost:8892/notebooks/Project_Comp_vision/CNNs and Keras.ipynb# 1/5 </span></p><p class="c2 c13"><span class="c24">11/6/2020 CNNs and Keras </span></p><p class="c30"><span class="c0">In&nbsp;[12]: </span></p><p class="c4"><span class="c0">1 2 </span></p><p class="c4"><span class="c0">plt.imshow(data[300]) plt.show() </span></p><p class="c44"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 257.23px; height: 251.23px;"><img alt="" src="images/image2.png" style="width: 257.23px; height: 251.23px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c21">Normalize the data </span></p><p class="c2"><span class="c0">In&nbsp;[17]: </span></p><p class="c2"><span class="c0">1 </span></p><p class="c2"><span class="c0">data = data.astype(&#39;float32&#39;) </span></p><p class="c3"><span class="c0">2 </span></p><p class="c3"><span class="c0">3 </span></p><p class="c2"><span class="c0">data /= 255 </span></p><p class="c3"><span class="c0">4 </span></p><p class="c3"><span class="c0">5 </span></p><p class="c3"><span class="c0">6 </span></p><p class="c14"><span class="c0">print(&quot;data shape:&quot;, data.shape) 7 </span></p><p class="c11"><span class="c0">print(&quot;Images in data:&quot;, data.shape[0]) 8 </span></p><p class="c2"><span class="c0">print(&quot;Max value in data:&quot;, data.max()) </span></p><p class="c47"><span class="c0">data shape: (4750, 128, 128, 3) Images in data: 4750 </span></p><p class="c32 c5"><span class="c0">Max value in data: 1.0 </span></p><p class="c49"><span class="c21">Gaussian Blurring </span></p><p class="c12"><span class="c1">Typesetting math: 0%</span></p><p class="c29"><span class="c24">localhost:8892/notebooks/Project_Comp_vision/CNNs and Keras.ipynb# 2/5 </span></p><p class="c2 c13"><span class="c24">11/6/2020 CNNs and Keras </span></p><p class="c30"><span class="c0">In&nbsp;[22]: </span></p><p class="c2"><span class="c0">1 </span></p><p class="c2"><span class="c0">pip install google</span><span class="c6">-</span><span class="c0">colab </span></p><p class="c2 c5"><span class="c21">&nbsp;</span><span class="c0">Found existing installation: urllib3 1.25.10 </span></p><p class="c3 c5"><span class="c0">&nbsp;Uninstalling urllib3-1.25.10: </span></p><p class="c3 c5"><span class="c0">&nbsp;Successfully uninstalled urllib3-1.25.10 </span></p><p class="c3 c5"><span class="c0">&nbsp;Attempting uninstall: idna </span></p><p class="c3 c5"><span class="c0">&nbsp;Found existing installation: idna 2.10 </span></p><p class="c3 c5"><span class="c0">&nbsp;Uninstalling idna-2.10: </span></p><p class="c3 c5"><span class="c0">&nbsp;Successfully uninstalled idna-2.10 </span></p><p class="c3 c5"><span class="c0">&nbsp;Attempting uninstall: requests </span></p><p class="c3 c5"><span class="c0">&nbsp;Found existing installation: requests 2.24.0 </span></p><p class="c3 c5"><span class="c0">&nbsp;Uninstalling requests-2.24.0: </span></p><p class="c3 c5"><span class="c0">&nbsp;Successfully uninstalled requests-2.24.0 </span></p><p class="c35"><span class="c0">Successfully installed google-auth-1.4.2 google-colab-1.0.0 idna-2.8 ipyk ernel-4.6.1 ipython-5.5.0 notebook-5.2.2 pandas-0.24.2 portpicker-1.2.0 p rompt-toolkit-1.0.18 requests-2.21.0 simplegeneric-0.8.1 six-1.12.0 torna do-4.5.3 urllib3-1.24.3 </span></p><p class="c40"><span class="c0">WARNING: You are using pip version 20.0.2; however, version 20.2.4 is ava ilable. </span></p><p class="c26"><span class="c0">You should consider upgrading via the &#39;/usr/local/Cellar/jupyterlab/2.0. 1/libexec/bin/python3.7 -m pip install --upgrade pip&#39; command. Note: you may need to restart the kernel to use updated packages. </span></p><p class="c19"><span class="c0">In&nbsp;[&nbsp;]: </span></p><p class="c2"><span class="c0">1 </span></p><p class="c2"><span class="c6">from </span><span class="c0">google.colab </span><span class="c6">import </span><span class="c0">drive </span></p><p class="c3"><span class="c0">2 </span></p><p class="c2"><span class="c6">from </span><span class="c0">scipy.signal </span><span class="c6">import </span><span class="c0">convolve2d </span></p><p class="c3"><span class="c0">3 </span></p><p class="c2"><span class="c6">import </span><span class="c0">cv2 </span></p><p class="c3"><span class="c0">4 </span></p><p class="c14"><span class="c6">from </span><span class="c0">google.colab.patches </span><span class="c6">import </span><span class="c0">cv2_imshow 5 </span></p><p class="c32"><span class="c0">6 </span></p><p class="c3"><span class="c0">7 </span></p><p class="c14"><span class="c0">Gaussian1 = data.GaussianBlur(image, (5, 5), 0) 8 </span></p><p class="c14"><span class="c0">Gaussian2 = data.GaussianBlur(image, (15, 15), 0) 9 </span></p><p class="c2"><span class="c0">print(&#39;Original Image:\n&#39;) </span></p><p class="c3"><span class="c0">10 </span></p><p class="c2"><span class="c0">cv2_imshow(image) </span></p><p class="c3"><span class="c0">11 </span></p><p class="c11"><span class="c0">print(&#39;\n Output after first gaussian blurring: \n&#39;) 12 </span></p><p class="c2"><span class="c0">cv2_imshow(Gaussian1) </span></p><p class="c3"><span class="c0">13 </span></p><p class="c14"><span class="c0">print(&#39;\n Output after second gaussian blurring: \n&#39;) 14 </span></p><p class="c2"><span class="c0">cv2_imshow(Gaussian2) </span></p><p class="c8"><span class="c21">Split the data </span></p><p class="c48"><span class="c0">In&nbsp;[14]: </span></p><p class="c2"><span class="c0">1 </span></p><p class="c2"><span class="c6">from </span><span class="c0">sklearn.model_selection </span><span class="c6">import </span><span class="c0">train_test_split </span></p><p class="c3"><span class="c0">2 </span></p><p class="c3"><span class="c0">3 </span></p><p class="c2"><span class="c0">X = data </span></p><p class="c3"><span class="c0">4 </span></p><p class="c2"><span class="c0">Y = labels </span></p><p class="c3"><span class="c0">5 </span></p><p class="c25"><span class="c0">X_train, X_test, ytrain, ytest = train_test_split( X, Y, test_size = 0.3 6 </span></p><p class="c15"><span class="c21">One hot encode the labels </span><span class="c1">Typesetting math: 0%</span></p><p class="c17"><span class="c24">localhost:8892/notebooks/Project_Comp_vision/CNNs and Keras.ipynb# 3/5 </span></p><p class="c2 c13"><span class="c24">11/6/2020 CNNs and Keras </span></p><p class="c30"><span class="c0">In&nbsp;[&nbsp;]: </span></p><p class="c2"><span class="c0">1 </span></p><p class="c4"><span class="c6">from </span><span class="c0">tensorflow.keras.utils </span><span class="c6">import </span><span class="c0">to_categorical 2 </span></p><p class="c32"><span class="c0">3 </span></p><p class="c31"><span class="c0">y_train = to_categorical(y_train, num_classes=12) 4 </span></p><p class="c4"><span class="c0">y_test = to_categorical(y_test, num_classes=12) 5 </span></p><p class="c32"><span class="c0">6 </span></p><p class="c4"><span class="c0">print(&quot;Shape of y_train:&quot;, y_train.shape) 7 </span></p><p class="c2"><span class="c0">print(&quot;One value of y_train:&quot;, y_train[0]) </span></p><p class="c18"><span class="c21">This does not need to be reshaped in order to work for Keras since its already in the format (n_e, n_h, n_w, n_c) </span></p><p class="c33"><span class="c37">n_e= number of examples, n_h = height, n_w = width, n_c = number of channels </span><span class="c21">Build model </span></p><p class="c2"><span class="c0">In&nbsp;[&nbsp;]: </span></p><p class="c2"><span class="c0">1 </span></p><p class="c2"><span class="c6">from </span><span class="c0">tensorflow.keras.layers </span><span class="c6">import </span><span class="c0">Conv2D </span></p><p class="c3"><span class="c0">2 </span></p><p class="c3"><span class="c0">3 </span></p><p class="c2"><span class="c0">model = Sequential() </span></p><p class="c3"><span class="c0">4 </span></p><p class="c14"><span class="c0">model.add(Conv2D(filters=32, kernel_size=3, activation=&quot;relu&quot;, input_sha 5 </span></p><p class="c25"><span class="c0">model.add(Conv2D(filters=32, kernel_size=3, activation=&quot;relu&quot;)) 6 </span></p><p class="c2"><span class="c0">model.add(Flatten()) </span></p><p class="c3"><span class="c0">7 </span></p><p class="c2"><span class="c0">model.add(Dense(128, activation=&quot;relu&quot;)) </span></p><p class="c3"><span class="c0">8 </span></p><p class="c2"><span class="c0">model.add(Dense(12, activation=&quot;softmax&quot;)) </span></p><p class="c22"><span class="c7">Split for validation dataset below in the fit </span></p><p class="c46"><span class="c0">In&nbsp;[&nbsp;]: In&nbsp;[&nbsp;]: </span></p><p class="c2"><span class="c0">1 </span></p><p class="c2"><span class="c10"># Compile the model </span></p><p class="c3"><span class="c0">2 </span></p><p class="c25"><span class="c0">model.compile(loss=&quot;categorical_crossentropy&quot;, metrics=[&quot;accuracy&quot;], opt 3 </span></p><p class="c32"><span class="c0">4 </span></p><p class="c2"><span class="c10"># Fit the model </span></p><p class="c3"><span class="c0">5 </span></p><p class="c2"><span class="c0">model.fit( x=X_train, y=ytrain, batch_size=32, epochs=10, validation_spl </span></p><p class="c36"><span class="c0">1 </span></p><p class="c2"><span class="c0">model.evaluate(X_test, ytest) </span></p><p class="c20"><span class="c21">Visualize the data </span></p><p class="c45"><span class="c37">x_test[2], x_test[3], x_test[33], x_test[36], x_test[59] </span></p><p class="c43"><span class="c0">In&nbsp;[&nbsp;]: In&nbsp;[&nbsp;]: </span></p><p class="c14"><span class="c0">1 2 </span></p><p class="c28"><span class="c0">1 2 </span></p><p class="c14"><span class="c0">plt.imshow(X_test[2]) plt.show() </span></p><p class="c28"><span class="c0">plt.imshow(X_test[3]) plt.show() </span></p><p class="c9"><span class="c1">Typesetting math: 0%</span></p><p class="c29"><span class="c24">localhost:8892/notebooks/Project_Comp_vision/CNNs and Keras.ipynb# 4/5 </span></p><p class="c2 c13"><span class="c24">11/6/2020 CNNs and Keras </span></p><p class="c30"><span class="c0">In&nbsp;[&nbsp;]: </span></p><p class="c27"><span class="c0">In&nbsp;[&nbsp;]: In&nbsp;[&nbsp;]: </span></p><p class="c4"><span class="c0">1 2 </span></p><p class="c23"><span class="c0">1 2 </span></p><p class="c16"><span class="c0">1 2 </span></p><p class="c4"><span class="c0">plt.imshow(X_test[33]) plt.show() </span></p><p class="c23"><span class="c0">plt.imshow(X_test[36]) plt.show() </span></p><p class="c16"><span class="c0">plt.imshow(X_test[59]) plt.show() </span></p><p class="c39"><span class="c1">Typesetting math: 0%</span></p><p class="c29"><span class="c24">localhost:8892/notebooks/Project_Comp_vision/CNNs and Keras.ipynb# 5/5 </span></p></div></body></html>